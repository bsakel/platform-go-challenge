# Project Structure (AI Generated)

This document describes the organization of the platform-go-challenge project.

## Directory Structure

```
platform-go-challenge/
├── api/                          # REST API handlers
│   ├── audience_handlers.go     # Audience CRUD handlers
│   ├── chart_handlers.go        # Chart CRUD handlers
│   ├── insight_handlers.go      # Insight CRUD handlers
│   ├── userstar_handlers.go     # UserStar CRUD handlers
│   └── model/                   # API response models
│       └── jsonResponse.go
│
├── db/                          # Database configuration
│   └── db.go                    # Database initialization and migrations
│
├── docs/                        # Documentation
│   ├── API_DOCUMENTATION.md     # REST & GraphQL API reference
│   ├── PROJECT_STRUCTURE.md     # This file
│   └── TESTING.md               # Comprehensive testing guide
│
├── graph/                       # GraphQL layer
│   ├── generated.go             # Generated GraphQL server code (DO NOT EDIT)
│   ├── model/                   # Generated GraphQL models
│   │   └── models_gen.go
│   ├── resolvers/               # GraphQL resolvers implementation
│   │   ├── resolver.go          # Base resolver struct with DB
│   │   ├── audience.resolvers.go
│   │   ├── chart.resolvers.go
│   │   ├── insight.resolvers.go
│   │   ├── userstar.resolvers.go    # CRUD operations for UserStar
│   │   └── userstared.resolvers.go  # Aggregated user stars query
│   └── schemas/                 # GraphQL schema definitions
│       ├── audience.graphqls
│       ├── chart.graphqls
│       ├── insight.graphqls
│       ├── userstar.graphqls         # UserStar type and CRUD
│       └── userstared.graphqls       # UserStared aggregation query
│
├── models/                      # Domain models (shared by REST & GraphQL)
│   ├── audience.go              # Audience model
│   ├── chart.go                 # Chart model
│   ├── insight.go               # Insight model
│   └── userstar.go              # UserStar model with AssetType enum
│
├── tests/                       # Test suite
│   ├── e2e/                     # End-to-end integration tests
│   │   ├── setup_test.go        # Test database setup and helpers
│   │   └── userstared_test.go   # UserStared query tests
│   ├── performance/             # Performance benchmarks
│   │   └── userstared_bench_test.go
│   └── unit/                    # Unit tests
│       └── userstar_test.go     # AssetType enum validation tests
│
├── .env                         # Environment variables (DB connection)
├── main.go                      # Application entry point
├── gqlgen.yml                   # GraphQL code generation config
├── go.mod                       # Go module dependencies
└── go.sum                       # Dependency checksums
```

## Key Components

### REST API (`/api`)
- Each model has its own handler file with CRUD operations
- Handlers use the `db.GormDB` global connection
- Standard operations: Create, Read (all/by-id), Update, Delete
- Returns JSON responses with standardized format

### GraphQL (`/graph`)
- **schemas/** - GraphQL schema definitions (`.graphqls` files)
  - Separate schema files for each entity and feature
  - `userstared.graphqls` - Aggregated query for user's starred items
- **resolvers/** - Implementation of GraphQL queries and mutations
  - Each schema has a corresponding resolver file
  - `userstared.resolvers.go` - Implements the aggregated user stars query
- **generated.go** - Auto-generated by gqlgen (DO NOT EDIT)
- **model/** - Auto-generated GraphQL types

### Database (`/db`)
- Single initialization point via `db.InitDB()`
- Automatic schema migration for all models using GORM AutoMigrate
- PostgreSQL database with connection string from `.env` file
- Uses GORM v2 as the ORM

### Models (`/models`)
- Shared domain models used by both REST and GraphQL
- GORM tags for database mapping (`gorm:"primaryKey"`, etc.)
- JSON tags for API serialization
- **Special features:**
  - `userstar.go` includes `AssetType` enum with validation
  - Implements `driver.Valuer` and `sql.Scanner` for type-safe DB operations

### Tests (`/tests`)
- **unit/** - Unit tests for model logic (e.g., enum validation)
- **e2e/** - End-to-end integration tests with real database
- **performance/** - Benchmark tests for query performance
- Uses separate test database (configured via `TEST_DB_URL` in `.env`)
- Test data seeding and cleanup utilities in `setup_test.go`

## AssetType Enum Pattern

The `UserStar` model uses a type-safe enum pattern for the `Type` field:

```go
// In models/userstar.go
type AssetType string

const (
    AssetTypeAudience AssetType = "Audience"
    AssetTypeChart    AssetType = "Chart"
    AssetTypeInsight  AssetType = "Insight"
)
```

**Key features:**
- **Validation**: `IsValid()` method ensures only valid types
- **Database integration**: Implements `driver.Valuer` and `sql.Scanner`
- **Type safety**: Compile-time checks when using constants
- **Strict validation**: Invalid values are rejected at runtime

**Usage:**
```go
// Creating a user star
star := models.UserStar{
    UserID:  1,
    Type:    models.AssetTypeAudience,  // Type-safe!
    AssetID: 123,
}
```

