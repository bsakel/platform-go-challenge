# Project Structure

This document describes the organization of the platform-go-challenge project.

## Directory Structure

```
platform-go-challenge/
├── api/                          # REST API handlers
│   ├── handlers.go              # Audience handlers
│   ├── chart_handlers.go        # Chart handlers
│   ├── insight_handlers.go      # Insight handlers
│   ├── userfavourite_handlers.go # UserFavourite handlers
│   └── model/                   # API response models
│
├── db/                          # Database configuration
│   └── db.go                    # Database initialization and migrations
│
├── graph/                       # GraphQL layer
│   ├── dataloader.go           # DataLoader for batching queries
│   ├── generated.go            # Generated GraphQL server code
│   ├── model/                  # Generated GraphQL models
│   │   └── models_gen.go
│   ├── resolvers/              # GraphQL resolvers (organized)
│   │   ├── resolver.go         # Base resolver struct
│   │   ├── audience.resolvers.go
│   │   ├── chart.resolvers.go
│   │   ├── insight.resolvers.go
│   │   └── userfavourite.resolvers.go
│   └── schemas/                # GraphQL schema definitions
│       ├── audience.graphqls
│       ├── chart.graphqls
│       ├── insight.graphqls
│       └── userfavourite.graphqls
│
├── models/                      # Domain models
│   ├── audience.go
│   ├── chart.go
│   ├── insight.go
│   ├── userfavourites.go
│   └── jsonResponse.go
│
├── main.go                      # Application entry point
├── gqlgen.yml                   # GraphQL code generation config
├── go.mod                       # Go module dependencies
└── go.sum                       # Dependency checksums
```

## Key Components

### REST API (`/api`)
- Each model has its own handler file
- Handlers use the `db.GormDB` connection
- Standard CRUD operations for all models

### GraphQL (`/graph`)
- **schemas/** - GraphQL schema definitions (`.graphqls` files)
- **resolvers/** - Implementation of GraphQL queries and mutations
- **generated.go** - Auto-generated by gqlgen (DO NOT EDIT)
- **dataloader.go** - Request-scoped batching and caching

### Database (`/db`)
- Single initialization point for the database
- Automatic migration for all models
- Uses GORM as the ORM

### Models (`/models`)
- Shared between REST and GraphQL
- GORM tags for database mapping
- JSON tags for API serialization

## Code Generation

GraphQL code is generated using gqlgen:

```bash
# Generate GraphQL server code
gqlgen generate
```

Configuration is in `gqlgen.yml`:
- Schema files location: `graph/schemas/*.graphqls`
- Resolvers directory: `graph/resolvers/`
- Model binding: Autobinds to `models/` package

## Resolver Organization

Resolvers are organized in the `graph/resolvers/` package:
- Each schema file gets its own resolver file
- All resolvers share the same `Resolver` struct with DB access
- Resolvers implement the `graph.ResolverRoot` interface

## DataLoader Pattern

The `graph/dataloader.go` file provides:
- Batching of database queries within a single GraphQL request
- Prevention of N+1 query problems
- Request-scoped caching

Used in the `Audience` resolver to efficiently load audiences.

## Running the Application

```bash
# Build
go build .

# Run
go run .

# Server starts on http://localhost:8080
```

Endpoints:
- REST API: `http://localhost:8080/`
- GraphQL API: `http://localhost:8080/graphql` (POST)
- GraphQL Playground: `http://localhost:8080/graphql` (GET)
